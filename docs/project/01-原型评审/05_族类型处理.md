# 族类型处理

## 一、族的分类

| 类型 | 文件格式 | 说明 | 示例 |
|-----|---------|------|------|
| **自建族（可载入族）** | .rfa | 独立文件，可单独加载 | 新风机、排风扇、百叶 |
| **系统族** | 无独立文件 | Revit 内置，在 .rvt 中 | 墙、楼板、天花板 |
| **叠层墙** | 无独立文件 | 多个基本墙的组合 | MCD-乳胶漆+小白砖+踢脚线 |

---

## 二、自建族处理

### 2.1 上传方式

```
Revit 中 → 易达插件 → 选择目标品目 → 上传 .rfa 文件
                          ↓
               插件解析族的所有参数
                          ↓
               族文件 + 参数信息 → 系统
```

**为什么必须在 Revit 中上传**：
- 只有通过插件才能解析 .rfa 文件的参数
- 网页直传无法提取参数信息

### 2.2 后续配置

上传后，在系统中配置：
1. 关联清单
2. 配置构件属性（新增/引用参数）
3. 为每个清单配置匹配条件
4. 配置工程量属性

### 2.3 示例

```
自建族：新风机
│
├── 上传：通过 Revit 插件上传 新风机.rfa
│
├── 参数解析：风量、功率等
│
├── 构件属性：
│   ├── 风量（引用族参数）
│   └── 功率（引用族参数）
│
├── 关联清单：
│   ├── 新风机(≥4000) → 匹配条件: 风量 >= 4000
│   ├── 新风机(2000-4000) → 匹配条件: 风量 >= 2000 AND < 4000
│   └── 新风机(<2000) → 匹配条件: 风量 < 2000
│
└── 工程量属性：计数，单位：台
```

---

## 三、系统族处理

### 3.1 与自建族的区别

| 维度 | 自建族 | 系统族 |
|-----|--------|--------|
| 文件格式 | 独立 .rfa | 在 .rvt 项目文件中 |
| 族类型数量 | 按需创建 | 预设较多 |
| 上传方式 | 直接上传 .rfa | 从 .rvt 中选择族类型上传 |
| 区分参数 | 各种参数 | 主要是「结构材质」 |

### 3.2 上传方式

```
Revit 中 → 易达插件 → 上传 .rvt 文件
                          ↓
               选择要上传到的品目
                          ↓
               选择对应的族类型
                          ↓
               上传到该品目
```

### 3.3 示例

```
系统族：楼板
│
├── 族类型：MCD-厨房灰色砖
│
├── 构件属性：
│   ├── 结构材质（引用族参数）= "厨房灰色砖"
│   └── 品牌（系统新增，下拉：琛雄/共荣/冠军）
│
├── 关联清单：
│   ├── 150x150mm灰色砖地面（琛雄）
│   │   └── 匹配条件: 结构材质 = "厨房灰色砖" AND 品牌 = "琛雄"
│   ├── 150x150mm灰色砖地面（共荣）
│   │   └── 匹配条件: 结构材质 = "厨房灰色砖" AND 品牌 = "共荣"
│   └── 150x150mm灰色砖地面（冠军）
│       └── 匹配条件: 结构材质 = "厨房灰色砖" AND 品牌 = "冠军"
│
└── 工程量属性：参数汇总（面积），单位：m²
```

---

## 四、叠层墙处理

### 4.1 什么是叠层墙

叠层墙是一个「容器」，由多个基本墙（系统族）垂直堆叠组成。

```
叠层墙（容器）
├── 上层：乳胶漆墙
├── 中层：小白砖墙
└── 下层：踢脚线墙
```

### 4.2 处理策略

**原则**：叠层墙只是组合使用，清单匹配和工程量计算基于基本墙。

```
┌─────────────────────────────────────────────────────────────────────┐
│                         职责分离                                     │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   基本墙体（核心）                    叠层墙（便捷组合）              │
│   ├── 乳胶漆墙 → 清单 + 工程量       ├── 只是把基本墙组合在一起       │
│   ├── 小白砖墙 → 清单 + 工程量       ├── 方便建模员使用               │
│   └── 踢脚线墙 → 清单 + 工程量       └── 不单独维护清单/工程量        │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 4.3 匹配流程

```
叠层墙（MCD - 乳胶漆+小白砖+踢脚线）
              ↓ 拆分
┌─────────────┼─────────────┐
↓             ↓             ↓
乳胶漆墙      小白砖墙      踢脚线墙
↓             ↓             ↓
匹配清单      匹配清单      匹配清单
↓             ↓             ↓
计算工程量    计算工程量    计算工程量
```

### 4.4 示例

```
叠层墙族类型：MCD - 乳胶漆+小白砖+同质踢脚线
│
├── 乳胶漆（上层）
│   ├── 清单：室内深色乳胶漆 / 室内浅色乳胶漆
│   └── 匹配条件：结构材质（颜色）
│
├── 小白砖（中层）
│   ├── 清单：墙面小白砖（琛雄/共荣/冠军）
│   └── 匹配条件：结构材质 + 品牌
│
└── 同质踢脚线（下层）
    ├── 清单：国产同质砖踢脚（琛雄/共荣/冠军）
    └── 匹配条件：结构材质 + 品牌
```

### 4.5 好处

1. **逻辑统一**：清单和工程量都基于基本墙体，和普通墙逻辑一致
2. **避免重复维护**：不用为每个叠层墙组合单独配置清单规则
3. **节省建模时间**：叠层墙预设好后，建模员一次性使用多个基本墙

---

## 五、幕墙处理（待讨论）

### 5.1 幕墙结构

```
幕墙（整体）
├── 嵌板（门/墙）
└── 框
```

### 5.2 工程量计算问题

```
幕墙工程量 = 幕墙面积 - 嵌板面积
```

**现状**：YDC 系统中，建模员手动出明细表，手动做减法

**待解决**：如何在系统中自动完成这种跨构件计算

---

## 六、族类型处理对比

| 族类型 | 上传方式 | 参数来源 | 匹配方式 | 特殊处理 |
|-------|---------|---------|---------|---------|
| 自建族 | .rfa 直接上传 | 族参数 + 系统新增 | 参数匹配 | 无 |
| 系统族 | .rvt 中选择上传 | 结构材质 + 系统新增 | 参数匹配 | 无 |
| 叠层墙 | - | 基于基本墙 | 拆分到基本墙 | 容器，只用于组合 |
| 幕墙 | - | - | - | 待讨论 |

---

## 变更记录

| 版本 | 日期 | 修改内容 |
|------|------|----------|
| v1.0 | - | 初稿 |
