# 水管工程量计算规则

> 梳理所有管件类型的工程量计算方式

**状态**: ✅ 规则设计完成
**截止日期**: 2025-12-25
**协作**: 薛飘飘（建模）、造价人员（计价规则）
**最后更新**: 2025-12-10

---

## 核心概念

### 工程量计算原则

**计量单位**: 长度（米）

**核心问题**: 管件（弯头、三通、四通、变径等）的长度如何分配给连接的管道？

**计算方式**: 按管件中心线长度计算，分配给连接的管道

---

## 规则总览

![水管工程量计算规则](../../../assets/pipe-rules/08-all-rules.png)

---

## 管件分类体系

```
管件分类
├── 双通（2个接口）
│   ├── 同径弯头（拐弯、不变径）
│   ├── 变径直通（不拐弯、变径）
│   └── 弯头+变径（拐弯、变径）
│
├── 三通（3个接口）
│   ├── 三通本体（等径/变径）
│   └── 三通口接变径
│
└── 四通（4个接口）
    ├── 四通本体（等径/变径）
    └── 四通口接变径
```

---

## 一、双通管件（2个接口）

### 1.1 同径弯头（拐弯，不变径）

```
              │
              │ 管道B
              │
         ╭────╯
         │  弯头
   ──────╯
    管道A
```

**长度分配规则**: 弯头中心线长度 **平分** 给两侧管道

| 项目 | 说明 |
|------|------|
| 弯头长度计算 | 插件自动计算中心线弧长 |
| 分配方式 | L_弯头 ÷ 2，各归一半给两侧管道 |
| 角度影响 | 任意角度均适用此规则 |

**示例**:
- 弯头中心线长度 = 0.4m
- 管道A 增加 = 0.2m
- 管道B 增加 = 0.2m

---

### 1.2 变径直通（不拐弯，变径）

```
    管道A (DN100)          管道B (DN50)
    ════════════╲        ╱═══════════
                 ╲______╱
                 变径管件
                 ◄─ L ─►
```

**长度分配规则**: 变径管件长度 **全归大口径管道**

| 项目 | 说明 |
|------|------|
| 分配方式 | 变径长度全部计入大口径管道工程量 |
| 示例 | DN100×DN50 变径，长度归 DN100 管道 |

---

### 1.3 弯头+变径（拐弯，变径）

```
        管道B (DN50)
            │
            │ 小口径
       ╭────╯
       │  弯头变径
 ──────╯
  管道A (DN100) 大口径
```

**长度分配规则**: 变径部分 **归直接连接的管道**

| 项目 | 说明 |
|------|------|
| 适用场景 | 既拐弯又变径的复合管件 |
| 分配方式 | 变径部分归直接连接的管道（小口径端） |

---

## 二、三通管件（3个接口）

### 结构示意

```
                    管道C (支管)
                        │
                        │ 口3
                        │
    管道A ══════════════╋══════════════ 管道B
         口1           三通           口2
                     (主管)
```

### 2.1 三通本体（等径/变径）

```
                    管道C (DN100)
                        │
    管道A (DN100) ══════╋══════ 管道B (DN100)
                     三通
```

**长度分配规则**: 按中心点 **三等分**

| 项目 | 说明 |
|------|------|
| 分配方式 | L_三通 ÷ 3，各归一份给三根管道 |
| 口径影响 | 无论等径/变径，均三等分 |

---

### 2.2 三通口接变径

```
                    管道C (DN25)
                        │
                       ╱  ← 变径 (DN50→DN25)
                      ╱
                     │ 口3 (DN50)
    管道A (DN100) ════╋════ 管道B (DN100)
                    三通
```

**分配规则**:
1. 三通本体按中心点三等分
2. 变径长度归直接连接的管道（管道C）

---

## 三、四通管件（4个接口）

### 结构示意

```
                    管道C
                        │
                        │ 口3
                        │
    管道A ══════════════╋══════════════ 管道B
         口1           四通           口2
                        │
                        │ 口4
                        │
                    管道D
```

### 3.1 四通本体（等径/变径）

**长度分配规则**: 按中心点 **四等分**

| 项目 | 说明 |
|------|------|
| 分配方式 | L_四通 ÷ 4，各归一份给四根管道 |
| 口径影响 | 无论等径/变径，均四等分 |

---

### 3.2 四通口接变径

**分配规则**:
1. 四通本体按中心点四等分
2. 变径长度归直接连接的管道

---

## 四、规则汇总表

### 管件长度分配规则

**双通（3种情况）**

| 情况 | 分配规则 | 说明 |
|------|---------|------|
| 同径弯头 | 平分 | 中心线长度 ÷ 2，各归两侧管道 |
| 变径直通 | 全归大口径 | 不拐弯，变径长度全归大口径管 |
| 弯头+变径 | 变径归连接管道 | 拐弯+变径，变径部分归直接连接的管道 |

**三通（2种情况）**

| 情况 | 分配规则 | 说明 |
|------|---------|------|
| 三通本体 | 三等分 | 无论等径/变径，三通长度均三等分 |
| 三通口接变径 | 变径归连接管道 | 变径长度归直接连接的管道 |

**四通（2种情况）**

| 情况 | 分配规则 | 说明 |
|------|---------|------|
| 四通本体 | 四等分 | 无论等径/变径，四通长度均四等分 |
| 四通口接变径 | 变径归连接管道 | 变径长度归直接连接的管道 |

### 决策树

```
管件长度分配
│
├── 双通？
│   ├── 同径弯头 → 平分给两侧
│   ├── 变径直通 → 全归大口径管
│   └── 弯头+变径 → 变径归连接管道
│
├── 三通？
│   ├── 三通本体 → 三等分
│   └── 三通口接变径 → 三等分 + 变径归连接管道
│
└── 四通？
    ├── 四通本体 → 四等分
    └── 四通口接变径 → 四等分 + 变径归连接管道
```

---

## 五、给易达的接口需求

### 需要插件提供的数据

| 数据项 | 说明 |
|--------|------|
| 管件类型 | 双通/三通/四通 |
| 管件中心线长度 | 弯头弧长、三通/四通整体长度 |
| 各接口口径 | 用于判断等径/变径 |
| 连接关系 | 每个口连接的是管道还是其他管件 |

### 计算逻辑由插件实现

| 规则 | 插件实现 |
|------|---------|
| 弯头平分 | 自动计算弧长 ÷ 2，累加到两侧管道 |
| 三通三等分 | 自动计算长度 ÷ 3，累加到三根管道 |
| 四通四等分 | 自动计算长度 ÷ 4，累加到四根管道 |
| 变径归属 | 判断连接对象，累加到目标管道 |

---

## 六、待确认事项

### 与薛飘飘确认

- [ ] Revit 中管件参数的准确名称
- [ ] 实际建模中是否存在其他特殊管件类型

### 与造价确认

- [ ] 以上规则是否符合造价计算要求
- [ ] 是否有特殊项目需要调整规则

---

## 图片资源

本文档使用的图片存放于 `docs/assets/pipe-rules/` 目录：

| 文件名 | 说明 |
|--------|------|
| `08-all-rules.png` | 7种管件计算规则综合图 |

---

## 变更记录

| 版本 | 日期 | 修改内容 |
|------|------|----------|
| v1.0 | 2025-12-10 | 创建模板 |
| v2.0 | 2025-12-10 | 完成规则设计（双通、三通、四通、变径） |
| v2.1 | 2025-12-10 | 添加可视化图片（7张） |
| v2.2 | 2025-12-10 | 精简为1张综合图，修正双通第三种为"弯头+变径" |
