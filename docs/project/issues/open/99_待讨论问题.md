# 待讨论问题

本文档汇总当前系统设计中尚未解决或需要进一步讨论的问题。

**优先级说明**：
- `P0` - 核心流程，阻塞开发
- `P1` - 重要功能，影响系统稳定性/灵活性
- `P2` - 后续扩展，不影响 MVP

---

## 一、幕墙工程量计算 ✅ 已解决

> **解决时间**：2025-12-03 会议
> **解决方案**：系统端可自定义配置组合

### 问题描述

幕墙的工程量计算涉及跨构件运算：

```
幕墙工程量 = 幕墙面积 - 嵌板面积
```

### 解决方案

**不是**系统自动做减法，而是：
- 插件端：通用插件已实现，代码集成
- 系统端：**可自定义配置化** —— 系统提供所有基础量（幕墙面积、门面积、窗面积等），用户根据项目需要自行配置组合公式

```
基础量全部列出 → 用户配置组合公式 → 输出工程量
如：幕墙工程量 = 幕墙面积 - 门面积 - 窗面积（可选）
```

---

## 二、工程量属性定制开发 `P1`

### 问题描述

目前工程量计算逻辑由易达定制开发：

- 用户告诉易达需要什么工程量
- 易达编写出量逻辑
- 这种模式的灵活性和可扩展性如何保证？

### 待讨论

1. **标准化**：是否可以抽象出通用的计算规则？
2. **自定义公式**：是否需要支持用户自定义计算公式？
3. **维护成本**：每新增一种计算方式都需要开发介入？

---

## 三、参数同步机制 `P1`

### 问题描述

系统参数与 Revit 参数的同步：

```
系统新增参数 → API 写入族 → 建模员修改 → 上传回系统
```

### 待明确

1. **冲突处理**：如果系统和 Revit 中参数值不一致，以哪边为准？
2. **版本控制**：参数配置变更后，已下载的族如何处理？
3. **批量更新**：是否支持批量更新已放置族实例的参数？

---

## 四、清单库及版本维护 `P1`

### 问题描述

清单数据从何而来？如何维护？版本如何管理？

### 初步方案（黄增沛 2025-11-25）

1. **架构**：沿用单价库 + 清单的方式
2. **版本策略**：
   - ❌ 去除大版本
   - ✅ 版本精确到**清单级别**
3. **核心识别**：清单编码 + 清单名称
4. **业态扩展**：切换业态（YDC、YBP）时增加扩展识别码
   - YDC 示例：co, pmtCode, assetCode, beType

### 待确认

1. [ ] 对比 YDC、汉堡王、奥乐齐的清单结构
2. [ ] 确认版本精确到清单级别的具体实现
3. [ ] YBP 业态的扩展识别码定义

---

## 五、多项目支持 `P2`

### 问题描述

系统是否需要支持多项目隔离？

### 待讨论

1. **品目库**：是全局共享还是项目独立？
2. **族库**：不同项目可能有不同的族配置
3. **清单库**：不同项目使用不同的清单标准

---

## 六、权限与角色 `P2`

### 问题描述

系统中不同角色的权限划分。

### 可能的角色

| 角色 | 职责 | 权限 |
|-----|------|------|
| 管理员 | 系统配置 | 全部 |
| 品目管理员 | 维护品目、清单关联 | 品目管理、清单配置 |
| 建模员 | 使用族库建模 | 族下载、模型上传 |
| 查看者 | 查看结果 | 只读 |

### 待讨论

1. **角色定义**：需要哪些角色？
2. **权限粒度**：权限划分到什么程度？
3. **数据隔离**：不同角色看到的数据范围？

---

## 七、异常处理 `P1`

### 问题描述

各种异常情况的处理策略。

### 场景列表

| 异常场景 | 当前处理 | 待讨论 |
|---------|---------|--------|
| 族实例未匹配到清单 | ? | 是否报警？默认清单？ |
| 参数值缺失 | ? | 跳过？默认值？ |
| 匹配到多个清单（非一对多场景） | ? | 优先级？报错？ |
| 几何参数值异常 | ? | 由 Revit 保证？ |

---

## 八、性能与规模 `P2`

### 问题描述

系统需要支持的数据规模。

### 待明确

1. **族库规模**：预计有多少个品目？多少个族类型？
2. **模型规模**：单个模型最大多少族实例？
3. **并发需求**：多少用户同时使用？

---

## 九、集成对接 `P2`

### 问题描述

与其他系统的集成需求。

### 可能的对接

- 采购系统：清单 + 工程量 + 单价
- 成本系统：成本分析
- 项目管理系统：进度关联
- ERP 系统：资源计划

### 待讨论

1. **接口标准**：采用什么数据格式？
2. **实时性**：实时对接还是批量导出？
3. **双向同步**：是否需要从外部系统同步数据？

---

## 十、插件开发 ✅ 已确认

> **确认时间**：2025-12-03 会议
> **确认方案**：独立插件 + 集成通用代码

### 问题描述

Revit 插件端需要提供哪些功能？

### 解决方案

**永麦专用插件**：
- 独立插件（主体），非基于通用插件改造
- 通用插件已有的类似功能代码集成进来
- 评审范围：包含在 12-04 评审内

### 功能点

- 族上传
- 族库浏览
- 族下载
- 模型上传
- 工程量计算（集成通用插件代码）

---

## 十一、完整链路待确认 `P0`

### 核心流程

```
维护族库 → 下载建模 → 上传数据 → 带出清单 → 计算工程量
```

### 关键澄清（游工 2025-11-25）

- 建模上传带出的是**含模型数据与参数的轻量化包**
- 清单需要在**系统中生成**（不是直接带出清单）

### 各环节状态

| 环节 | 负责方 | 状态 |
|-----|--------|------|
| 族维护 | - | ✅ 已讨论 |
| 插件下载/上传 | 游工？ | ⏳ 待确认 |
| 系统匹配 | 易达 | ⏳ 待确认 |
| 清单生成 | 黄增沛 | 🔄 有思路 |
| 工程量计算 | 易达 | ✅ 已可用 |

---

## 十二、工程量计算技术实现 `P0` 🔄 部分确认

> 2025-11-27 新增 - Stephen 负责推进
> 2025-12-03 更新 - 会议讨论部分确认

### 问题描述

需要搞清楚易达工程量计算的技术实现方式，为后续功能开发做准备。

### 已确认

| 问题 | 结论 |
|------|------|
| 幕墙工程量 | 系统端可自定义配置组合基础量 |
| 跨品目清单 | 确认支持（用 A 族建模，出 B 清单） |
| 系统名称细分 | 插件端不难，系统端通过品目配置关联 |

### 待专项梳理

| 问题 | 说明 | 负责人 |
|------|------|--------|
| 水管计算规则 | 所有管件（双头、三通、变径等） | Stephen |
| 风管系统细分 | "系统名称"属性应用范围 | Stephen |
| 配置语法 | 具体语法待后续试用确认 | Stephen |

### 12月核心任务

**Stephen 负责**：全面梳理 YBP 业主清单的工程量计算部分

输出物：
1. 《水管工程量计算规则》
2. 《系统名称属性应用范围清单》
3. 《业主清单工程量分类表》（麦当劳、奥乐齐）

**1月起**：李昱全面接管 YBP 系统开发

---

## 十三、评审进度追踪 ✅ 已确认

> **确认时间**：2025-12-03 会议
> **评审时间**：2025-12-04

### 评审范围

三个模块全部在评审范围内：
1. 族库维护
2. 插件功能
3. 系统端清单/工程量

### 后续安排

| 事项 | 说明 |
|------|------|
| 清单库维护 | 黄增沛 ↔ 李昱 直接对接 |
| 清单分类维护 | 李工与黄工另行对接 |
| 系统开发 | 1月起李昱全面接管 |

---

## 十三、历史讨论记录

### 已确定的方案

| 问题 | 确定方案 | 确定时间 |
|-----|---------|---------|
| 叠层墙处理 | 拆分到基本墙处理 | - |
| 参数区间匹配 | 使用范围运算符 | - |
| 一对多清单 | 无条件全匹配 | - |
| 几何参数 | 系统只读，不可修改 | - |

### 待确定的方案

| 问题 | 候选方案 | 优先级 | 状态 |
|-----|---------|--------|------|
| 幕墙工程量 | 系统可配置组合 | 高 | ✅ 已解决 |
| 工程量自定义公式 | 系统端配置 | 中 | ✅ 已解决 |
| 清单库来源 | 待讨论 | 中 | ⏳ 待定 |
| 水管计算规则 | 需专项梳理 | 高 | 🚧 进行中 |
| 系统名称细分 | 品目配置关联 | 中 | ✅ 已解决 |

---

## 变更记录

| 版本 | 日期 | 修改内容 |
|------|------|----------|
| v1.0 | - | 初稿 |
| v2.0 | 2025-11-25 | 更新清单库方案、添加插件开发、完整链路、评审追踪 |
| v3.0 | 2025-11-27 | 新增「工程量计算技术实现」章节（重点），更新评审状态 |
| v4.0 | 2025-12-03 | 根据会议结论更新：幕墙✅、插件✅、评审✅、工程量🔄 |
| v4.1 | 2025-12-10 | 为所有待讨论问题添加优先级标注（P0/P1/P2） |
