# 业务逻辑摘要

> 第一阶段核心结论提取，供后续阶段快速参考

**来源**: [01-原型评审/](../01-原型评审/)

---

## 核心业务流程

```
族上传 → 品目配置 → 清单匹配规则 → 工程量配置
                                        ↓
建模员下载族 → 建模 → 导出BIM数据包 → 系统匹配清单 → 计算工程量
```

---

## 清单匹配（5种方式）

| 方式 | 说明 | 示例 |
|------|------|------|
| 无条件匹配 | 所有族实例都匹配 | 排风扇 → 电源清单 |
| 单参数区间 | 参数值落在区间内 | 风量 >= 4000 → 清单A |
| 单参数精确 | 参数值精确匹配 | 结构材质 = "厨房灰色砖" |
| 多参数AND | 多条件同时满足 | 材质 + 品牌 |
| 多参数区间联合 | 多参数都做区间判断 | 风量 + 功率 |

**要点**:
- 从清单出发配置匹配条件
- 一个族实例可带出多个清单
- 条件组内是 AND 逻辑

**详见**: [02_清单匹配逻辑.md](../01-原型评审/02_清单匹配逻辑.md)

---

## 工程量计算（4种方式）

| 方式 | 说明 | 单位示例 |
|------|------|----------|
| 计数 | 统计族实例数量 | 台、个、套 |
| 参数汇总 | 某参数值求和 | m²、m、m³ |
| 带系数 | 基础值 × 系数 | 考虑损耗 |
| 跨构件计算 | 涉及多构件运算 | 幕墙面积 - 嵌板面积 |

**配置项**:
- 计算方式
- 汇总参数（参数汇总时）
- 单位
- 系数（可选）

**详见**: [03_工程量计算.md](../01-原型评审/03_工程量计算.md)

---

## 参数体系

### 按几何影响分类

| 类型 | 影响几何 | 系统可改 | 说明 |
|------|:--------:|:--------:|------|
| 几何参数 | ✅ | ❌ 只读 | 长、宽、高、面积 |
| 非几何参数 | ❌ | ✅ 可维护 | 风量、功率、品牌 |

### 同步机制

- **几何参数**: Revit → 系统（只读）
- **非几何参数**: 系统 ↔ Revit（双向）

### 参数新增逻辑

- 同名 → 引用族参数
- 新名 → 新增参数（可选类型/实例）

**详见**: [04_参数体系.md](../01-原型评审/04_参数体系.md)

---

## 族类型处理

| 族类型 | 文件格式 | 上传方式 | 特殊处理 |
|--------|----------|----------|----------|
| 自建族 | .rfa | 直接上传文件 | 无 |
| 系统族 | 在 .rvt 中 | 提取类型定义数据 | 无法导出为独立文件 |
| 叠层墙 | 在 .rvt 中 | 拆分到基本墙处理 | 容器，只用于组合 |
| 幕墙 | - | - | 待讨论（跨构件计算） |

**叠层墙处理原则**: 清单匹配和工程量计算基于基本墙，叠层墙只是便捷组合。

**详见**: [05_族类型处理.md](../01-原型评审/05_族类型处理.md)

---

## 待深入问题（第二阶段）

- [ ] 幕墙跨构件计算实现
- [ ] 工程量计算执行位置（插件端 vs 服务器端）
- [ ] 复杂公式支持
- [ ] 永麦专用插件 vs 通用插件

---

**最后更新**: 2025-12-02
