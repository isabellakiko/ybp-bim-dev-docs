# 工程量计算

## 一、工程量的作用

1. **采购依据**：清单 + 工程量 + 单价 = 成本
2. **核心输出**：YBP 系统的最终产出是「清单 + 工程量」

---

## 二、计算方式

### 2.1 计数

统计族实例的数量。

| 单位 | 适用场景 |
|-----|---------|
| 台 | 设备（新风机、排风扇） |
| 个 | 配件（电源） |
| 套 | 成套设备 |

**示例**：
- 清单「新风机3000M3/H」下有 5 个族实例 → 工程量 = 5 台

### 2.2 参数汇总

某个参数值的求和。

| 单位 | 参数 | 适用场景 |
|-----|------|---------|
| m² | 面积 | 百叶、墙面、地面 |
| m | 长度 | 管道、线缆 |
| m³ | 体积 | 混凝土 |

**示例**：
- 清单「防雨排风百叶(截面≤0.25m²)」下有 3 个族实例
- 面积分别是 0.20、0.15、0.24 m²
- 工程量 = 0.20 + 0.15 + 0.24 = 0.59 m²

### 2.3 带系数的计算

工程量 = 基础值 × 系数

**场景**：某些清单的计算规则需要乘以系数

**示例**：
- 基础值：3 台
- 系数：1.1（考虑损耗）
- 工程量 = 3 × 1.1 = 3.3 台

### 2.4 跨构件计算（待讨论）

工程量涉及多个构件的参数运算。

**场景**：幕墙

```
幕墙工程量 = 幕墙面积 - 嵌板面积
```

**现状**：YDC 系统中，建模员手动出明细表，手动做减法

**待解决**：如何在系统中自动完成这种跨构件计算

---

## 三、工程量属性配置

在品目参数的「工程量属性」中配置：

```
工程量属性
├── 计算方式：计数 / 参数汇总
├── 汇总参数：（如选择参数汇总）引用哪个参数
├── 单位：台 / 个 / m² / m / m³
└── 系数：（可选）
```

### 配置示例

**新风机**：
```
工程量属性
├── 计算方式：计数
└── 单位：台
```

**防雨排风百叶**：
```
工程量属性
├── 计算方式：参数汇总
├── 汇总参数：百叶窗面积
└── 单位：m²
```

---

## 四、计算流程

```
匹配完成后，每个清单下有若干族实例
              ↓
根据该清单的工程量属性配置
              ↓
┌─────────────────────────────────────┐
│ 计算方式 = 计数？                    │
│     → 统计族实例数量                 │
│                                     │
│ 计算方式 = 参数汇总？                │
│     → 累加每个族实例的指定参数值     │
└─────────────────────────────────────┘
              ↓
应用系数（如有）
              ↓
输出：清单 + 工程量 + 单位
```

---

## 五、计算示例

### 5.1 新风机（计数）

**模型数据**：
- 风量3000：3个
- 风量5000：2个
- 风量7000：1个

**输出**：

| 清单 | 工程量 | 单位 |
|-----|-------|------|
| 新风机3000M3/H | 3 | 台 |
| 新风机5000M3/H | 2 | 台 |
| 新风机7000M3/H | 1 | 台 |

### 5.2 排风扇（计数，一对多）

**模型数据**：5个排风扇

**输出**：

| 清单 | 工程量 | 单位 |
|-----|-------|------|
| 小型排风扇安装（不含主材） | 5 | 台 |
| 供应(不含安装)小型排风扇 | 5 | 台 |
| 小型排风扇电源 | 5 | 个 |

### 5.3 防雨排风百叶（参数汇总）

**模型数据**：
- 实例1：面积 0.20m²（匹配清单A）
- 实例2：面积 0.15m²（匹配清单A）
- 实例3：面积 0.60m²（匹配清单C）

**输出**：

| 清单 | 工程量 | 单位 |
|-----|-------|------|
| 防雨排风百叶(截面≤0.25m²) | 0.35 | m² |
| 防雨新风百叶(0.5m²<截面≤0.75m²) | 0.60 | m² |

---

## 六、工程量属性 vs 构件属性

| 属性 | 用途 | 配置位置 |
|-----|------|---------|
| **构件属性** | 匹配清单 | 品目参数 - 构件属性 |
| **工程量属性** | 计算工程量 | 品目参数 - 工程量属性 |

两者独立配置，互不干扰：
- 构件属性决定「带出哪个清单」
- 工程量属性决定「该清单的量是多少」

---

## 七、待讨论问题

1. **幕墙跨构件计算**：幕墙面积 - 嵌板面积，如何自动实现？
2. **复杂公式**：是否需要支持自定义公式？
3. **工程量属性由易达定制**：目前方案是需要什么工程量，告诉易达，易达写出量逻辑

---

## 变更记录

| 版本 | 日期 | 修改内容 |
|------|------|----------|
| v1.0 | - | 初稿 |
