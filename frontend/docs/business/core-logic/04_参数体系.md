# 参数体系

## 一、参数分类

### 1.1 按对几何的影响分类

| 类型 | 影响几何 | 说明 | 示例 |
|-----|:-------:|------|------|
| **几何参数** | ✅ | 影响族的外形尺寸 | 长度、宽度、高度、面积 |
| **非几何参数** | ❌ | 不影响外形，纯标签 | 风量、功率、品牌 |

### 1.2 按来源分类

| 来源 | 说明 | 系统可改 | Revit可改 |
|-----|------|:-------:|:--------:|
| **族原有参数** | 族本身定义的参数 | 视类型而定 | ✅ |
| **系统新增参数** | 在系统中新增的参数 | ✅ | ✅（写入族后） |

---

## 二、几何参数

### 2.1 特点

- 影响族的外形（修改长度会改变形状）
- Revit 会验证参数值的合规性（不合规会阻止）
- **系统中只读**：只能在 Revit 中修改，系统只能查看

### 2.2 处理方式

```
族上传到系统
      ↓
插件解析族的几何参数
      ↓
系统显示参数（只读）
      ↓
可用于清单匹配条件（引用）
      ↓
但不能在系统中修改值
```

### 2.3 为什么系统不能改几何参数

- Revit 会验证几何参数的合规性（如长度不能为负）
- 系统没有这个验证机制
- 随意修改可能导致回到 Revit 时出问题
- 所以：**系统只引用，不修改**

### 2.4 示例

```
品目：防风排风百叶
│
├── 几何参数（从族提取，系统只读）
│   ├── 百叶长度
│   ├── 百叶宽度
│   └── 百叶窗面积（公式 = 长度 × 宽度，Revit中也只读）
```

---

## 三、非几何参数

### 3.1 特点

- 不影响族的外形
- 只是用于区分清单的「标签」
- **系统可维护**：可以在系统中新增、修改

### 3.2 处理方式

```
系统新增参数（或引用族中已有的）
      ↓
配置输入方式（数值框、下拉选择等）
      ↓
下发到 Revit（通过 API 写入族）
      ↓
建模员在 Revit 中可修改（实例参数）
      ↓
上传回系统用于清单匹配
```

### 3.3 示例

```
品目：新风机
│
├── 非几何参数（系统维护）
│   ├── 风量（数值，用于清单区间匹配）
│   └── 功率（数值，可能用于联合匹配）
│
├── 品牌（系统新增，下拉选择，用于精确匹配）
```

---

## 四、构件属性中的参数处理

### 4.1 参数新增逻辑

在「品目参数 - 构件属性」中新增参数时：

```
新增参数，输入名称
        ↓
名称与族中某参数完全一致？
        ↓
    ┌───┴───┐
    是      否
    ↓       ↓
 引用族参数  新增参数
            ├── 默认：族参数（Revit可改）
            └── 可选：类型参数 / 实例参数
```

### 4.2 好处

1. **不用显示所有参数**：族可能有很多参数，只新增需要的
2. **同名自动引用**：避免重复，保证数据一致
3. **灵活新增**：族中没有的参数可以通过系统新增

### 4.3 参数配置项

| 配置项 | 说明 |
|-------|------|
| 名称 | 参数名称 |
| 单位 | 如：M3/H、mm、m² |
| 输入方式 | 数值框、文本框、下拉选择 |
| 选项值 | 下拉选择时的可选项（如：琛雄/共荣/冠军） |
| 类型/实例 | 类型参数还是实例参数 |

---

## 五、参数与 Revit 的同步

### 5.1 几何参数

```
Revit（源） ───提取───→ 系统（只读显示）
     ↑                      │
     │                      │
     └──────── 不回写 ───────┘
```

### 5.2 非几何参数

```
系统 ───下发───→ Revit（可修改）
  ↑                   │
  │                   │
  └───── 上传回 ──────┘
```

### 5.3 同步流程

```
┌─────────────────────────────────────────────────────────────────────┐
│                        配置阶段                                      │
├─────────────────────────────────────────────────────────────────────┤
│   1. 上传族到系统（通过 Revit 插件）                                 │
│   2. 系统提取族的参数（几何 + 非几何）                               │
│   3. 在构件属性中新增/引用参数                                       │
│   4. 系统新增的参数，通过 API 写入族                                │
└─────────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────────┐
│                        建模阶段                                      │
├─────────────────────────────────────────────────────────────────────┤
│   1. 建模员从族库下载族                                              │
│   2. 族中已包含系统配置的参数                                        │
│   3. 建模员按需修改参数值（实例参数）                                │
│   4. 几何参数：Revit 验证合规性                                      │
│   5. 非几何参数：自由修改                                           │
└─────────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────────┐
│                        匹配阶段                                      │
├─────────────────────────────────────────────────────────────────────┤
│   1. 上传模型到系统                                                  │
│   2. 系统读取每个族实例的参数值                                      │
│   3. 根据参数值进行清单匹配                                         │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 六、实例参数 vs 类型参数

### 6.1 区别

| 类型 | 作用范围 | 修改影响 | 适用场景 |
|-----|---------|---------|---------|
| **类型参数** | 同族类型共享 | 改一个，同类型全变 | 固定规格 |
| **实例参数** | 各实例独立 | 只改当前实例 | 灵活变化 |

### 6.2 在 YBP 中的应用

**优化后的逻辑推荐使用实例参数**：

- 一个品目只需一个默认品目类型
- 参数设为实例参数
- 建模员按需修改参数值
- 修改不会产生新的族类型

---

## 七、参数体系总结

```
品目参数
│
├── 构件属性（用于清单匹配）
│   │
│   ├── 几何参数（族提取，系统只读）
│   │   └── 长度、宽度、面积...
│   │
│   ├── 非几何参数（系统维护）
│   │   └── 风量、功率、品牌...
│   │
│   └── 参数新增逻辑
│       ├── 同名 → 引用
│       └── 新名 → 新增（可选类型/实例）
│
└── 工程量属性（用于出量）
    └── 计算方式、汇总参数、单位、系数
```

---

## 变更记录

| 版本 | 日期 | 修改内容 |
|------|------|----------|
| v1.0 | - | 初稿 |
